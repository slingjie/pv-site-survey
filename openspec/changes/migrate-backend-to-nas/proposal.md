# 变更提案：后端迁移至 NAS 自建服务

## 背景问题

- 当前后端基于 Cloudflare Worker + D1，所有报告数据（含图片 Base64）序列化后存入 D1 单表。
- 在手机端上传多张原图或大尺寸照片时，单条记录体积容易接近或超过 D1/Worker 的限制，导致保存失败。
- 同时，用户希望将后端与数据库部署在自有 NAS 上，以便完全掌控数据与运行环境。

## 目标

- 提供一套可部署在家用 NAS 上的后端服务与数据库：
  - 保持与现有 Worker 相同的 REST API 接口（路径与语义兼容）。
  - 使用本地数据库（例如 SQLite / PostgreSQL），消除 D1 单条记录容量限制。
  - 保留当前前端的交互与数据结构，前端仅需切换 `API_BASE` 即可对接新后端。

## 非目标

- 本次变更不强制引入对象存储或拆分图片存储，仅先解决“可自建后端 + 数据不受 D1 限制”的问题。
- 不在本次变更内处理权限体系、多租户或审计日志等高级需求。

## 高层方案

- 在 NAS 上部署一个 Node.js 服务（建议使用 Express/Hono 等轻量框架），监听 HTTP 端口并提供 `/api/projects` 系列接口。
- 使用与 `backend/schema.sql` 等价的数据库结构，在本地数据库中创建 `projects` 表。
- 将 `backend/src/worker.ts` 中各个 handler 的 SQL 与业务逻辑迁移到新的 Node 服务中。
- 为前端设置可切换的 `API_BASE`（例如通过环境变量），以便在 Cloudflare Worker 与 NAS 后端之间平滑切换。 

